<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Week 2 Workshop: Setting up reproducible data science with R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Charlotte Hadley" />
    <script src="week-02_workshop_reproducibility_files/header-attrs/header-attrs.js"></script>
    <link href="week-02_workshop_reproducibility_files/remark-css/default.css" rel="stylesheet" />
    <link href="week-02_workshop_reproducibility_files/remark-css/ninjutsu.css" rel="stylesheet" />
    <script src="week-02_workshop_reproducibility_files/xaringanExtra-progressBar/progress-bar.js"></script>
    <link rel="stylesheet" href="css/workshop-styles.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" type="text/css" />
    <link rel="stylesheet" href="assets/ninpo.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Week 2 Workshop: Setting up reproducible data science with R
]
.author[
### <large>Charlotte Hadley</large>
]

---


class: split-two, with-thick-border border-black



<style>.xe__progress-bar__container {
  top:0;
  opacity: 1;
  position:absolute;
  right:0;
  left: 0;
}
.xe__progress-bar {
  height: 5px;
  background-color: #36506A;
  width: calc(var(--slide-current) / var(--slide-total) * 100%);
}
.remark-visible .xe__progress-bar {
  animation: xe__progress-bar__wipe 200ms forwards;
  animation-timing-function: cubic-bezier(.86,0,.07,1);
}
@keyframes xe__progress-bar__wipe {
  0% { width: calc(var(--slide-previous) / var(--slide-total) * 100%); }
  100% { width: calc(var(--slide-current) / var(--slide-total) * 100%); }
}</style>


.column.bg-main1[.content[
  .split-three[
 .row[.content[
 # 1. Reproducible code
 ]]
  .row[.content[
 # 2. Reproducible referencing
 ]]
   .row[.content[
 # 3. Working with datasets in R reproducibly
 ]]
 ]
]]

.column.bg-main1[.content.center.vmiddle[
  # 4. Understanding the assessment template
]]

---

class: inverse, middle, center

# Reproducible code

---

# Reseach code is research software

If your research includes R code that reads and wrangles your data in such a way that you can:

- Create charts

- Test statistical hypotheses are compute statistical measures

- Calculate measures of your data

... then you're writing research software and it's an intrinsic part of your research.

&lt;hr&gt;

You might even develop your R code into an R package that others can reuse for similar analyses. 

However, that's definitely beyond the scope of this course.

&gt; Now you're writing software we need to equip you with some software development tools

---

# Version control with git

.pull-left[

Version control is extremely important in software development to ensure future changes to code don't break existing code.

This is particularly true when code is being worked on by multiple people.

]

.pull-right[

]

---

# Version control with git

.pull-left[

Version control is extremely important in software development to ensure future changes to code don't break existing code.

This is particularly true when code is being worked on by multiple people.

The most widely used version control tool used today is called `git`.

`git` is an extremely powerful, open-source tool.

&gt; We are going to ignore almost all of its features and use only what we need.
&gt; 
&gt; Just like most people who use it.
]

.pull-right[

&lt;center&gt;
&lt;img src='images/xkcd_git.png' height='500px'/&gt;
https://xkcd.com/1597/
&lt;center&gt;
]

---

# git repositories

Each individual project that uses `git` is called a **repository**.

If you decided to use `git` to version control your assignment then that would be a repository.

---

# git and the command line

`git` was originally designed to be used in the command line

- On Windows that usually means using cmd.exe

- On macOS and Linux that means the Terminal

This practically means that you'd be using a *command line interface* (CLI) to work with the git technology.

&lt;hr&gt;

In the case of `git` it can be beneficial to use a GUI interface instead of the CLI to conceptualise what actions you're about to - and often more importantly - what actions were taken in the past.

---

# GitHub

.pull-left[

GitHub is one of many different tools for managing *git repositories*.

We're going to prefer GitHub because it has lots of really awesome features.

It's also owned by Microsoft which **radically** simplifies installing `git` onto your machine.

&lt;hr&gt;

Let's first create an account.

1. Visit [github.com](https://github.com/) and click sign-up (if you don't already have an account)

1. Don't worry about being creative with your username now - you can change it later without things exploding *too much*.

]

.pull-right[
&lt;img src='images/github-desktop-logo.png'/&gt;
]

---

# GitHub Desktop

.pull-left[

When you install GitHub Desktop it installs both `git` and a GUI for working with repositories on GitHub.

1. Download the application from [desktop.github.com/](https://desktop.github.com)

1. Run through the installer

1. Sign-in with your GitHub account.
]

.pull-right[
&lt;img src='images/github-desktop-logo.png'/&gt;
]

---

# Organising your computer

From this point onwards we need to be careful about organising our code.

- RStudio projects should **not** contain projects themselves

- Git repositories should **never** contain another git repository&lt;sup&gt;1&lt;/sup&gt;

It's best practice to have **one folder** on your machine call GitHub and for all repositories to be stored in that folder.

.footnote[
[1] This is getting into quite advanced territory, but if you needed a repo to depend on another you would use [submodules](https://git-scm.com/book/en/v2/Git-Tools-Submodules).
]

---

# Creating a new repository

.pull-left[

We're going to make use of the `{usethis}` package to help us create a well-formed new repository.

&gt; Please open RStudio and install the {usethis} package.

]

.pull-right[
&lt;center&gt;
&lt;img src='images/github-desktop-logo.png' height='250px'/&gt;
&lt;br&gt;
&lt;img src='images/hexsticker_usethis.png'/&gt;
&lt;/center&gt;
]

---

# Creating a new repository

.pull-left[

We're going to make use of the `{usethis}` package to help us create a well-formed new repository.

I'm going to demonstrate how to do this first **afterwards** I'll show the instructions and then create your own repository.

]

.pull-right[
&lt;center&gt;
&lt;img src='images/github-desktop-logo.png' height='250px'/&gt;
&lt;br&gt;
&lt;img src='images/hexsticker_usethis.png'/&gt;
&lt;/center&gt;
]

---

# Creating a new repository

.pull-left[

1\. In RStudio use the "Project Menu" choose

  - New Project...
  
  - New directory
  
  - New project
  
2\. Set the name of the directory as `eng7218-week-2-workshop`

3\. Create the project as a subdirectory of your GitHub folder
]

.pull-right[

4\. Inside of this project run this in the R console


```r
usethis::use_git()
```

5\. Open GitHub Desktop and select


```markdown
File &gt; Add Local Repository
```

]

---

# Publish to GitHub.com

If everything is good your GitHub Desktop will look like this - let's publish the repository!

&lt;img src='images/screenshot_gh-publish-repository.jpg' height='500px'/&gt;

---

# Publish to GitHub.com

.pull-left[
- We then get to name the repository on Github.com - use the same name!!

- We then get to choose if our code is private or not

  - If you're applying an embargo to your data, you probably want to do the same on GitHub!
  
  - Public repositories can be seen by anyone and are useful for your CV
]

.pull-right[
&lt;img src='images/screenshot_gh-publish-repository_modal.jpg'/&gt;
]

---

# Let's add some sensitive data to the repo (I)

When adding data to your repository it's important to have **two** directories.

- `data-raw` contains your sensitive data and data anonymisation scripts

- `data` contains a copy of your anonymous data

&gt; We're going to prevent the `data-raw` folder from being sent to GitHub.com

---

# Let's add some sensitive data to the repo (II)

.pull-left[
1. Use the New Folder button to create a folder called `data-raw`

]

.pull-right[
&lt;img src='images/screenshot_new-folder.jpg'/&gt;
]

---

# Let's add some sensitive data to the repo (II)

.pull-left[
1. Use the New Folder button to create a folder called `data-raw`

1. Click inside the `data-raw` folder in the Files tab

1. Select "Text file" from the "New Blank File" menu
]

.pull-right[
&lt;img src='images/screenshot_new-blank-text-file.jpg'/&gt;
]

---

# Let's add some sensitive data to the repo (II)

.pull-left[
1. Use the New Folder button to create a folder called `data-raw`

1. Click inside the `data-raw` folder in the Files tab

1. Select "Text file" from the "New Blank File" menu

1. Add some fake data into the file

1. Save this file into the `data-raw` folder and call it something like `patient-data.csv`
]

.pull-right[
&lt;img src='images/screenshot_fake-data.jpg'/&gt;
]

---

# Check GitHub Desktop

When you switch to GitHub Desktop we see that `git` has tracked changes in the repo.

We want to prevent this entire directory from going to GitHub

- The repo on your machine is called "the local repository"

- The repo on Github is called "the remote repository"

&lt;img src='images/screenshot_gh-data-raw.jpg'/&gt;

---

# Commit this change to the repository

.pull-left[

1\. Switch back to GitHub

2\. Add a commit message

&gt; These should be short and sweet, like "added data-raw"

3\. **Optionally** add a summary

4\. Click "Commit to master"

]

.pull-right[
&lt;img src='images/screenshot_gh-tracked-gitignore.jpg'/&gt;
]

&gt; In `git` when we "commit" something we tell `git` to remember our change in the local repository.

---

# Pushing our changes to the remote repository

.pull-left[
After committing locally it's time to **push** the changes to GitHub.com

Click the "push origin" button and the changes will be sent to the remote!
]

.pull-right[
&lt;img src='images/screenshot_after-commit.jpg'/&gt;
]

---

# Pulling is the opposite of pushing

.pull-left[

Remember that `git` is designed for collaboration.

Imagine a collaborator has pushed a change to the remote repository **but** you don't have those changes in your machine.

If you refresh GitHub Desktop you'll be prompted to "pull origin" - which will bring the changes to your local repository.
]

.pull-right[
&lt;img src='images/screenshot_gh-changes-to-pull.jpg'/&gt;
]

---

# GitHub branches and pull requests

This is as far as we'll go with using `git` for version control.

In real-world projects you would use two additional features: branches and pull requests.

&gt; There is a really good, simple to follow tutorial here: https://docs.github.com/en/get-started/quickstart/hello-world
&gt;
&gt; There are also tutorials on LinkedIn Learning.

---

# Modify the .gitignore file

.pull-left[
1. Switch back to RStudio

1. Go to the project directory

1. Open the `.gitignore` file

1. Add `data-raw/` to the file and **save it**
]

.pull-right[
&lt;img src='images/screenshot_gh-ignore.jpg'/&gt;
]

---

# Connecting Figshare &amp; Github

GitHub is an awesome place for code to *live*.

It's a **bad** choice for preserving code for the future.

Fortunately, it's simple to connect your Figshare account with GitHub which gives you a fairly reproducible coding workflow.

---

class: inverse, center, middle

# Reproducible referencing

---

# Referencing is part of research (and the assessment)

Managing your references is an unavoidable part of doing research and is part of the assessment.

.pull-left[

There are several reference management tools available.

- EndNote is widely taught however it's close source, expensive and [in my own personal opinion] rubbish.

- Mendeley is much better but it's closed source has limited shared library functionality.

- Zotero is open source, has good shared library functionality and has lots of extensions.

]

.pull-right[
&lt;img src='images/zotero-logo.webp'/&gt;

&gt; I'm going to teach you how to use Zotero. But choose which software works for you!
]

---

# Setting up Zotero

1. Create a free account at [zotero.org/](https://www.zotero.org/)

1. Download the software from [zotero.org/](https://www.zotero.org/)

1. Install the software and login to your Zotero account


---

# Improving Zotero with Better Bibtex for Zotero

We're going to install the "Better Bibtex" addin which improves how Zotero generates bibtex files.

&gt; BibTeX is an extremely useful and very widely used tool for storing, managing and typsetting references
&gt;
&gt; It was originally designed to work with LaTeX which we're purposefully avoiding.

---

# Improving Zotero with Better Bibtex for Zotero

The instructions for installing Better Bibtex.

.pull-left[
1. Download the tool from [https://github.com/retorquere/zotero-better-bibtex/releases](https://github.com/retorquere/zotero-better-bibtex/releases)

]

.pull-right[
&lt;img src='images/screenshot_better-bibtex-download.jpg'/&gt;
]

---

# Improving Zotero with Better Bibtex for Zotero

The instructions for installing Better Bibtex.

.pull-left[
1\. Download the tool from [https://github.com/retorquere/zotero-better-bibtex/releases](https://github.com/retorquere/zotero-better-bibtex/releases)

2\. Open Zotero and select

`Tools &gt; Add-ons`

3\. In the popup click on the ⚙️ item and select "Install Add-on From File..."

4\. Select the `.xpi` file you just downloaded

5\. Restart Zotero

]

.pull-right[
&lt;img src='images/screenshot_better-bibtex-install-addin.jpg'/&gt;
]

---

# Web browser plug-in

.pull-left[

One of the best things about Zotero is how easy it is to add resources to your collection directly from the web browser.

Please install the plugin for your browser of choice

[zotero.org/download/connectors](https://www.zotero.org/download/connectors)
]

.pull-right[

&lt;img src='images/screenshot_zotero-connectors.jpg'/&gt;

]

---

# Adding a paper to Zotero

I'd like you to add the "Why Most Published Research Findings are False" paper to your Zotero collection.

&gt; You need your browser and Zotero open simultaneously. 

.pull-left[

1. Visit [doi.org/10.1371/journal.pmed.0020124](https://doi.org/10.1371/journal.pmed.0020124)

1. Click on the Zotero plugin icon and click "Done"

1. Go over to Zotero and you'll see the paper has been added!

]

.pull-right[
&lt;center&gt;
&lt;img src='images/screenshot_zotero-plugin-most-findings-are-false.jpg' height='400px'/&gt;
&lt;/center&gt;
]

---

# Using Zotero

.pull-left[
You can now use Zotero to organise your papers, web pages and reports. All of the things you need to **cite and reference**.

- Zotero includes a PDF viewer where you can annotate and highlight PDFs.

- You can organise things via folders.

- Tags are another useful tool for organising research
]

.pull-right[
&lt;img src='images/screenshot_zotero-collection-example.jpg'/&gt;
]

---

# Connecting this to an RStudio project

Our goal is to setup a workflow where we can synchronise our Zotero library with an RStudio project so that we can write a report and add references as we grow our library.

We installed Better BibTeX because it allows us to automate this process.

&gt; You'll need to do this for each project you want to connect to your Zotero collection.

---

# Sync Zotero with an RStudio Project

.pull-left[
1. Add an .Rmd document to your RStudio project called something like `Report.Rmd`.

- The YAML header is looking for a BibTeX file called `references.bib` which we've not created yet

- We've added a "References" header before the references.
]

.pull-right[

```default
---
title: "Example report"
output: 
  pagedown::html_paged:
    toc: false
knit: pagedown::chrome_print
bibliography: references.bib
---


# References

::: {#refs}
:::
```

]

---

# Sync Zotero with an RStudio Project

.pull-left[
1. Add an .Rmd document to your RStudio project called something like `Report.Rmd`.

1. Open Zotero and go to `File &gt; Export library`

  - Set the format as Better BibTeX

  - Select "Keep updated"

1. Save the file into your RStudio project and call it `references.bib` 


]

.pull-right[
&lt;img src='images/screenshot_zotero-export-popup.jpg'/&gt;
]


---

# Sync Zotero with an RStudio Project

.pull-left[
1. Add an .Rmd document to your RStudio project called something like `Report.Rmd`.

1. Open Zotero and go to `File &gt; Export library`

  - Set the format as Better BibTeX

  - Select "Keep updated"

1. Save the file into your RStudio project and call it `references.bib`

1. Open Zotero preferences and go to the BetterBibTeX section

- Choose the "Automatic Export" tab

- Set "Automatic export" to "On Change"


]

.pull-right[
&lt;img src='images/screenshot_zotero_automatic-export-on-change.jpg'/&gt;
]

---

# Sync Zotero with an RStudio Project

.pull-left[
1. Add an .Rmd document to your RStudio project called something like `Report.Rmd`.

1. Open Zotero and go to `File &gt; Export library`

1. Save the file into your RStudio project and call it `references.bib` 

1. Save the file into your RStudio project and call it `references.bib`

1. Open Zotero preferences and go to the BetterBibTeX section

1. In your .Rmd file cite the paper we added using the citation key... and knit the document!


]

.pull-right[

```default
---
title: "Example report"
output: 
  pagedown::html_paged:
    toc: false
knit: pagedown::chrome_print
bibliography: references.bib
---

Ah, yes the @ioannidis_why_2005 paper.

# References

::: {#refs}
:::

```

]

---

# Zotero citation keys

.pull-left[
Zotero automatically generate citation keys for you.

I strongly against editing these yourself - they're best as machine-readable data instead of human-readable data.


]

.pull-right[
&lt;img src='images/screenshot_zotero-citation-key.jpg'/&gt;
]

---

# Challenge

.pull-left[

1. Find a paper from a journal

1. Add it to Zotero with the browser plug-in

1. Cite the new paper in your RMarkdown document

1. Knit the .Rmd file together and see the new item in your references

]

.pull-right[

&gt; You might want to look at the last few slides of [Week 2's lecture slides](https://eng7218.netlify.app/lecture-slides/week-02_slides_reproducibility.html) which contain at least 40 references.

]

---

# Zotero and MS Word

Good news! Zotero should automatically install a add-in for citing your collection within MS Word.

.pull-left[
1. Open MS Word and look for a Zotero tab. If it's **not** there continue with these instructions.

1. Open Zotero preferences and go to `Cite &gt; Word Processors`

1. Click "Re-install Microsoft Word Add-in

1. Restart Zotero and MS Word
]

.pull-right[
There are [really good instructions on how to use this add-in](https://www.zotero.org/support/word_processor_plugin_usage) on the Zotero website.
]

---

# Adding things that aren't papers to Zotero

It's really easy to use Zotero with papers that have DOI.

But if you want to cite a website or white paper you might want to add this manually to your collection.

- Ensure that all items have a date. 

  - Often webpages/reports don't have dates, but check the URL just in case `turing.ac.uk/.../2021-06/...pdf`
  
  - If no date is available go for the current year
  
- If no authors are listed then use the name of the website or institution

- Add an "accessed date"

---

# Shared Zotero collection

I've created a shared Zotero collection for this semester - https://www.zotero.org/groups/4758381/eng7218-shared-2022/library.

Let's discuss how we might use this collection as a class.

---

# What reproducibility skills have we learned?

- You need an ORCID! Get one and use it everywhere.

- Use Figshare to reserve DOI for research outputs before you start

  - It'll make it easier to write your research up!
  
- Use Figshare to store your talks, posters and anything else you want to make available for the future

- Use GitHub for version controlling your code

  - Keep sensitive data off GitHub with the .gitignore file

- Connect your Figshare and GitHub repos to make your code citable and avaialble for the future

- Use Zotero for storing and managing all your references

- Use the Better BibTeX add-in to keep your `.bib` file up to date in an RStudio project.

---

# Advanced topics (for the end)

To completely ensure the reproducibility of R code projects you would need to ensure that future users have access to the **exact** same packages as you used.

The best solution for this is to use the `{renv}` package.

I've personally avoided it for projects recently because I haven't worked on code that I need others to replicate into the future. If you're writing research software then please do consider using it. There's [good documentation](https://rstudio.github.io/renv/articles/renv.html) for it.

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="js/macros.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
